

\section{Les exceptions}


\subsection{Principe}

\begin{frame}
  \frametitle{Principe}
  \begin{itemize}
  \item Mécanisme de gestion des erreurs en Python\pause
  \item Détournement du fonctionnement du programme
  \item[$\Rightarrow$] Bloc de traitement de l'erreur\pause
  \item Nombreuses fonctions intégrées (built-in) de Python et de modules utilisent des exceptions
  \item[$\Rightarrow$] lire la documentation
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Exemple}
  {\small
  \begin{semiverbatim}
	>>> a = 10/0 \pause
Traceback (most recent call last):
  File "<pyshell#2>", line 1, in <module>
    a = 10/0
\colorbox[rgb]{1,0,0}{ZeroDivisionError}: division by zero
>>>  

  \end{semiverbatim}}
\end{frame}
\begin{frame}[fragile]
\frametitle{Exemple}
  {\small
  \begin{semiverbatim}
	>>> nb = int(input("Entrez un nombre: ")) \pause
Entrez un nombre: \pause dix\pause
Traceback (most recent call last):
  File "<pyshell#1>", line 1, in <module>
    nb = int(input("Entrez un nombre: "))
\colorbox[rgb]{1,0,0}{ValueError}: invalid literal for int() with base 10: 'dix'
>>> 
  \end{semiverbatim}}
	\pause
		\begin{itemize}
		\item Autres exemples 
				\begin{itemize}
			\item  Accéder à une clé non-existante d'un dictionnaire $\rightarrow$ \texttt{KeyError}
			\item  Chercher une valeur non-existante dans une liste $\rightarrow$ \texttt{ValueError}
			\item  Appeler une méthode non-existante $\rightarrow$ \texttt{AttributeError}
			\item  Référencer une variable non-existante $\rightarrow$ \texttt{NameError}
			\item  Mélanger les types de données sans conversion $\rightarrow$\texttt{ TypeError}
			\item ...


		\end{itemize}
	\end{itemize}
\end{frame}

\subsection{Traitement des exceptions}

\begin{frame}
  \frametitle{Traitement}
 
  Deux possibilités :
  \begin{itemize}
  \item<1-| alert@3> traiter l'exception localement ;
  \item<2-| alert@4> transmettre l'exception à la fonction appelante.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Traitement local : \emph{try-except}}

  Traiter une exception localement : utiliser le bloc \emph{try-except-finally}.
  \begin{itemize}
  \item try : certaines instructions peuvent lever une exception
  \item except : traitement d'une exception
	\item else (optionnelle). Instructions exécutées si aucune exception n'est levée
  \item finally (optionnelle): instruction exécutées après le bloc \emph{try} et les
    \emph{except} éventuels.
	
  \end{itemize}

\end{frame}

\begin{frame}[fragile]
  \frametitle{Syntaxe}
  Syntaxe :
  \begin{semiverbatim}
	
\textcolor[rgb]{0,0,1}{try} :\textcolor[rgb]{0,0.58,0}{
    \# Cette fonction peut lever une exception}
    fonction_levant_une_exception()
\textcolor[rgb]{0,0.58,0}{\# Ici on récupère toutes les exceptions}
\textcolor[rgb]{0,0.58,0}{\# héritant de Exception}
\textcolor[rgb]{0,0,0.55}{except} Exception as err:
    \textcolor[rgb]{0,0.58,0}{\# Traitement de lexception}
    print (err)
\textcolor[rgb]{0,0.58,0}{\# Suite du programme}
  \end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Syntaxe}
  Traitement de plusieurs exceptions :
  \begin{semiverbatim}
	try :
    # ...
except Exception1 :
    # ...
except Exception2 :
    # ...
except (Exception3, Exception4) :
    # ...
finally :
    # ...
  \end{semiverbatim}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Exemple}
  \begin{exemple}
     \begin{semiverbatim}
\vspace{-1cm}
\textcolor[rgb]{0,0,1}{try}:
    resultat = num / den
\textcolor[rgb]{0,0,1}{except} NameError:
    print("une des variables n'a pas été défini.")
\textcolor[rgb]{0,0,1}{except} TypeError:
    print("Type incompatible du num ou den.")
\textcolor[rgb]{0,0,1}{except} ZeroDivisionError:
    print("denominateur est égale à 0.")
\textcolor[rgb]{0,0,1}{else}:
    print("Le résultat obtenu est", resultat)
\end{semiverbatim}
\end{exemple}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Exemple}
  \begin{exemple}
     \begin{semiverbatim}
\vspace{-1cm}
\textcolor[rgb]{0,0,1}{try}:
    nb = int(input("Entrez un nombre: "))
\textcolor[rgb]{0,0,1}{except} ValueError: 
    print ("Vous n'avez pas entré un nombre !")
\textcolor[rgb]{0,0,1}{finally}:
    print("Relancer le programme")
\pause	
Entrez un nombre: dix
Vous n'avez pas entré un nombre !
Relancer le programme
\pause
Entrez un nombre: 10
Relancer le programme
 \end{semiverbatim}

  \end{exemple}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Exemple}
  \begin{exemple}
     \begin{semiverbatim}
\vspace{-1cm}
\textcolor[rgb]{0,0,1}{while} True :
    \textcolor[rgb]{0,0,1}{try}:
        nb = int(input("Entrez un nombre: "))
        break
    \textcolor[rgb]{0,0,1}{except} ValueError as err:
        print (err)
        print ("Réessayer")

\pause	
Entrez un nombre: dix
invalid literal for int() with base 10: 'dix'
Réessayer \pause
Entrez un nombre: 10
 \end{semiverbatim}

  \end{exemple}
\end{frame}



\begin{frame}[fragile]
  \begin{alertblock}{Ne pas détourner l'usage des exceptions}
    \begin{semiverbatim}
\textcolor[rgb]{0,0,1}{try} :
    \textcolor[rgb]{0,0.58,0}{# Calcul de l'indice désiré}
    indice = calcul_indice_tableau()
    \textcolor[rgb]{0,0.58,0}{# Accès systématique à la liste : 
    #  - l'exception gère les dépassements}
    x = tableau [indice]
\textcolor[rgb]{0,0,1}{except} IndexError as err:
    pass
    \end{semiverbatim}
  \end{alertblock}
\end{frame}


\begin{frame}[fragile]
  \begin{remarque}[Remplacement de l'exception par un test]
    \begin{semiverbatim}
\textcolor[rgb]{0,0.58,0}{# Calcul de l'indice désiré}
indice = calcul_indice_tableau ()
\textcolor[rgb]{0,0.58,0}{# Test de validit é de l'indice}
\textcolor[rgb]{0,0,1}{if} indice >=0 and indice <len( tableau ):
    \textcolor[rgb]{0,0.58,0}{# Accès au tableau si l'indice est valide}
    x = tableau [ indice ]    
		\end{semiverbatim}
  \end{remarque}
\end{frame}


\subsection{Déclenchement d'une exception}

\begin{frame}[fragile]
  \frametitle{Lever une exception}

  Lever une exception dans une méthode : utilisation de \emph{raise}

\uncover<2>{
 Syntaxe
    \begin{semiverbatim}
      raise TypeDeLException("votre message à afficher")
    \end{semiverbatim}
  Permet de gérer les erreurs par le mécanisme d'exception.
}
\end{frame}

\begin{frame}[fragile]
  \begin{exemple}[Entier positif]
    \begin{semiverbatim}
		\vspace{-1cm}
\textcolor[rgb]{0,0.58,0}{# L'utilisateur saisit l'année}
entier = input("donner un entier positif:") 
\textcolor[rgb]{0,0,1}{try}:
    \textcolor[rgb]{0,0.58,0}{# la fonction int() peut lever une exception}
    entier = int(entier) 
    \textcolor[rgb]{0,0,1}{if} entier<=0:
		    \textcolor[rgb]{0,0.58,0}{# On lève une exception }
        \textcolor[rgb]{0,0,1}{raise} ValueError("nombre invalide")
\textcolor[rgb]{0,0,1}{except} ValueError as e:
    print(e)
    \end{semiverbatim}
  \end{exemple}
\textcolor[rgb]{0,0.58,0}{\# sortie}\\
\texttt{donner un entier positif:dix \\\pause
invalid literal for int() with base 10: 'dix'\\
\pause
donner un entier positif:-10 \pause \\
nombre invalide}
	
\end{frame}




\begin{frame}[fragile]
  \frametitle{Définition de classes d'exception}

  \begin{itemize}
  \item Définition de classes exception utilisateur
  \item Critères~:
    \begin{itemize}
    \item<1-> hériter de la classe \emph{Exception}
    \item<3-> possibilité de redéfinir \emph{\twound{str}\twound{}}
    \end{itemize}
  \item<4-> exception utilisable comme les autres
  \end{itemize}

  \begin{exemple}
    \begin{semiverbatim}
		\vspace{-1cm}
		\scriptsize{\uncover<1->{
   class MonException (Exception ): }\uncover<2->{
       def __init__ (self, valeur ):  
           self.valeur = valeur}\uncover<3->{
       def __str__ ( self ):
	         return repr( self.valeur )}
	\uncover<4->{
    try :
	        raise ( MonException ("message à afficher") )
    except MonException as err :
        print ('Exception : ', err.value)
		}}
    \end{semiverbatim}
  \end{exemple}
\end{frame}



\section{Utilisation de fichiers}


\subsection{Principe}

\begin{frame}
  \frametitle{Intérêt}

  \begin{itemize}[<+->]
	\item sauver des données, des résultats de calcul et traitements, des simulations, \dots
  \item Accéder à des données persistantes
  
	\item Nécessité de transférer les données en mémoire
  \item[$\Rightarrow$] dans des variables
  \item Différents types de fichiers
    \begin{itemize}
    \item texte
    \item binaire
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Intérêt}
  \begin{block}{Exemple de fichiers textes}
\begin{itemize}
	\item Pages Web (html, css, \dots)
\item Fichier journal (log), Script shell (bat)
\item Images vectorielles (svg)
\item Programmes Python (py)
\item Les fichiers de données texte (txt, data, \dots)
\item Les fichiers texte formatés (xml)
\end{itemize}
\end{block}
\end{frame}
\subsection{Lecture de fichiers texte}

\begin{frame}
  \frametitle{Lecture de fichier}
  \begin{block}{Principe}
	
	\begin{itemize}
  \item ouverture de fichier avec la fonction  \texttt{open()}
  \item lecture de son contenu :
	\begin{itemize}
		\item .readline() lit le fichier ligne par ligne 
		\item .read() lit l'ensemble du fichier
    \item .readlines() renvoie une liste contenant chaque ligne
	\end{itemize}
	\item fermeture de fichier avec la fonction \texttt{close()}
  \end{itemize}
   \end{block}
	\pause
	\begin{alertblock}{Attention}
	Prendre la bonne habitude de toujours fermer le fichier !
	\end{alertblock}
  %\only<-4>{
  %\begin{exemple}
    %\begin{semiverbatim}
%
    %\end{semiverbatim}
  %\end{exemple}}

\end{frame}
\begin{frame}
  \frametitle{Ouverture d'un fichier }
  \begin{block}{La commande \texttt{open}}
		\texttt{f=open("mon\_fichier.txt", mode = "rt")}
   \end{block}
	\pause
	\begin{block}{Les trois modes d'accès}
	
	\begin{itemize}
		\item \emph{r} : ouverture en lecture (read)
		\item \emph{w} : ouverture en écriture (write), le fichier est écrasé, si il n'existe pas, alors il est crée.
		\item \emph{a} : ouverture en écriture en mode ajout (append), les données sont ajoutées à la suite du fichier.
	\end{itemize}
	\end{block}
	avec les deux type de données :
	
	\begin{itemize}
		\item "t" pour du texte, 
		\item "b" pour la lecture en mode binaire
	\end{itemize}
  %\only<-4>{
  %\begin{exemple}
    %\begin{semiverbatim}
%
    %\end{semiverbatim}
  %\end{exemple}}

\end{frame}




\begin{frame}[fragile]
  \frametitle{Lecture de fichier}
    \begin{exemple}[Lecture des caractères d'un fichier]
    \begin{semiverbatim}\scriptsize{
\textcolor[rgb]{0,0,1}{try} :
    \textcolor[rgb]{0,0.58,0}{# Ouverture du fichier texte en lecture seule}
    f = \textcolor[rgb]{1,0.41,0.13}{open} ("mon\_fichier.txt") \textcolor[rgb]{0,0.58,0}{# f = open ("mon\_fichier.txt","rt")}
\textcolor[rgb]{0,0,1}{except} IOError as e:
    \textcolor[rgb]{0,0.58,0}{# En cas d'exception, afficher un message d'erreur}
    print ("Ouverture du fichier impossible \\n", e)
\textcolor[rgb]{0,0,1}{else :}
    \textcolor[rgb]{0,0.58,0}{# Lecture du fichier, et mise du contenu dans une variable}
    caracteres = \textcolor[rgb]{1,0.41,0.13}{f.read ()}
    print ("Nombre de caractères du fichier :", len(caracteres))
    \textcolor[rgb]{0,0.58,0}{# fermeture de fichier}
   \textcolor[rgb]{0,0.58,0}{ # f.close()}}
    \end{semiverbatim}
  \end{exemple}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Lecture de fichier}
    \begin{exemple}[Lectures par lignes]
    \begin{semiverbatim}
		\vspace{-1cm}
		\scriptsize{
\textcolor[rgb]{0,0,1}{try} :
    f = \textcolor[rgb]{1,0.41,0.13}{open} ("mon\_fichier.txt") 
except IOError as e:
    print ('Ouverture du fichier impossible \\n', e)
    sys.exit(1)
\textcolor[rgb]{0,0.58,0}{# Lire le fichier sous forme de liste de lignes}\pause
les_lignes = f.\textcolor[rgb]{1,0.41,0.13}{readlines} ()
print ('Nombre de lignes :', len( les_lignes ))\pause
\textcolor[rgb]{0,0.58,0}{# Mettre le curseur au début du fichier}
f. seek (0)\pause
\textcolor[rgb]{0,0.58,0}{# Lecture du fichier ligne à ligne avec une boucle for}\pause
for ligne in f:
\textcolor[rgb]{0,0.58,0}{# Affiche chaque ligne du fichier à l'envers}
   print ( ligne [:: -1] , end='')
\textcolor[rgb]{0,0.58,0}{# Fermeture du fichier après lecture}\pause\color[rgb]{1,0.41,0.13}
 f. close ()
}
    \end{semiverbatim}
  \end{exemple}
\end{frame}





\begin{frame}

\end{frame}



\subsection{Écriture de fichiers texte}

\begin{frame}
  \frametitle{Écriture bas niveau}

  \begin{itemize}
  \item<1-> Utilisation d'un \emph{FileWriter}
  \item<2-> Méthode \emph{write} : écrit un tableau de caractères ou une
    \emph{String}
  \end{itemize}

  \begin{exemple}
    \begin{semiverbatim}
      \only<1>{{\color<1>{red}FileWriter ecrivain;}

        try \{

        \hspace{0.9cm}{\color<1>{red}ecrivain = new FileWriter(nomFichier);}

      \}~catch (IOException e) \{

      \hspace{0.9cm}System.out.println("Ouverture du fichier "+nomFichier+" impossible");

      \hspace{0.9cm}System.out.println(e);

      \}}
    \only<2>{try \{

      \hspace{0.9cm}String message="Une chaîne de caractères.$\backslash$n";

      \hspace{0.9cm}ecrivain.write(message);

      \hspace{0.9cm}ecrivain.close();

    \}~catch (IOException e) \{

      \hspace{0.9cm}System.out.println(e);

    \}}
    \end{semiverbatim}
  \end{exemple}
\end{frame}


\begin{frame}
  \frametitle{Écriture sous forme de flot}
  \begin{itemize}
  \item<1-> Utilisation d'un \emph{PrintStream}
  \item<2-> Permet d'écrire différents types de données
  \item<2-> Ne génère pas d'exception
  \end{itemize}

  \begin{exemple}
    \begin{semiverbatim}
      \only<1>{
        File monFic = new File(nomFichier);

        try \{

        \hspace{1cm}ecrivain = new PrintStream(new FileOutputStream(monFic));

        \}~catch (FileNotFoundException e) \{

        \hspace{1cm}System.out.println(e);

        \}}
      \only<2>{
        String message="Un exemple de message.";

        ecrivain.println(message);

        ecrivain.print(42);

        ecrivain.close();
      }
    \end{semiverbatim}
  \end{exemple}
\end{frame}


\subsection{Fichiers binaires}

\begin{frame}
  \frametitle{Lecture de fichiers binaires}
  \begin{itemize}
  \item<1-> Utilisation d'un \emph{DataInputStream}
  \item<2-> Lecture de \emph{double} \only<3->{, de \emph{int}} \only<4->{, de
      \emph{boolean}} \only<5->{, ...}
  \end{itemize}

  \begin{exemple}
    \begin{semiverbatim}
      \only<1>{
        DataInputStream ecrivain;

        try \{

        \hspace{0.5cm}ecrivain = \textcolor{red}{new DataInputStream(new FileInputStream(nomFichier))};

        \}~catch (FileNotFoundException e) \{

        \hspace{0.5cm}System.out.println(e);

        \}   }
      \only<2->{
        try \{

        \hspace{1cm}double x = {\color<2>{red}ecrivain.readDouble();}
        
        \uncover<3->{\hspace{1cm}int i = {\color<3>{red}ecrivain.readInt();}

        }
        \uncover<4->{\hspace{1cm}boolean b =
          {\color<4>{red}ecrivain.readBoolean();} 

        }
        \}~catch (IOException e) \{

        \hspace{1cm}System.out.println(e);

        \} }
    \end{semiverbatim}
  \end{exemple}
\end{frame}

\begin{frame}
  \frametitle{Écriture de fichiers binaires}
  \begin{itemize}
  \item<1-> Utilisation d'un \emph{DataOutputStream}
  \item<2-> Écriture de \emph{double}, de \emph{int}, ...
  \end{itemize}

  \begin{exemple}
    \begin{semiverbatim}
      \only<1>{
        DataOutputStream ecrivain;

        try \{

        \hspace{0.5cm}ecrivain = \textcolor{red}{new DataOutputStream(new FileOutputStream(nomFichier))};

        \}~catch (FileNotFoundException e) \{

        \hspace{0.5cm}System.out.println(e);

        \}   }      
      \only<2>{
        try \{

        \hspace{1cm}ecrivain.\textcolor{red}{writeDouble(Math.PI)};

        \hspace{1cm}ecrivain.\textcolor{red}{writeInt(42)};

        \hspace{1cm}ecrivain.\textcolor{red}{writeUTF("message")};

        \}~catch (IOException e) \{

        \hspace{1cm}System.out.println(e);

        \} }
    \end{semiverbatim}
  \end{exemple}
\end{frame}


\subsection{Sérialisation}


\begin{frame}
  \frametitle{Principe}
  \begin{itemize}
  \item Sauvegarder directement des objets dans un fichier
  \item Puis les récupérer très simplement
  \item Utilisation de l'interface \emph{Serializable}
  \item Lecture/écriture du fichier par
    \emph{ObjectOutputStream}/\emph{ObjectInputStream} et
    \emph{wrtiteObject}/\emph{readObject}.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Exemple}
  \begin{enumerate}
  \item<1-> Rendre la classe "sérialisable"
  \item<2-> Sauvegarder les objets
  \item<3-> Restaurer les objets
  \end{enumerate}
  \begin{semiverbatim}
    \only<1>{
      public class Cercle \textcolor{red}{implements Serializable}
      \vspace{2cm}
    }
    \only<2>{
      FileOutputStream fichier = 

      \hspace{2cm}new FileOutputStream("fic.tmp");

      ObjectOutputStream ecrivain = 

      \hspace{2cm}new ObjectOutputStream(fichier);

      Cercle unObjet = new Cercle(10);

      ecrivain.\textcolor{red}{writeObject(unObjet);}
    }
    \only<3>{
      FileInputStream fichier = 

      \hspace{2cm}new FileInputStream("fic.tmp");

      ObjectInputStream lecteur = 

      \hspace{2cm}new ObjectInputStream(fichier);

      Cercle unObjet;

      unObjet = \textcolor{red}{(Cercle)lecteur.readObject();}
    }
  \end{semiverbatim}
\end{frame}


\section{Les paquetages}

\begin{frame}
  \begin{itemize}[<+->]
  \item Objectif : regrouper les classes
  \item Plusieurs classes peuvent avoir le même nom dans des paquetages
    différents
  \item Un paquetage = un répertoire
  \item Ajouter {\color<4>{red}\emph{package monPaquetage;}}
  \item Intérêt : possibilité d'importer toutes les classes d'un paquetage
  \item Ex : {\color<6>{red}\emph{import java.util.*;}}
  \end{itemize}
\end{frame}

